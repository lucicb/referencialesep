{% extends 'base.html' %}

{% block titulo %}
Detalle del Pedido
{% endblock %}

{% block contenido %}
<div class="container mt-4">
    <h3>Detalle del Pedido N° {{ pedido.nro_pedido }}</h3>

    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
    Información del Pedido
</div>

        <div class="card-body">
            <p><strong>Funcionario:</strong> {{ pedido.funcionario }}</p>
            <p><strong>Sucursal:</strong> {{ pedido.sucursal }}</p>
            <p><strong>Depósito:</strong> {{ pedido.deposito }}</p>
            <p><strong>Fecha Pedido:</strong> {{ pedido.fecha_pedido }}</p>
            {% if pedido.fecha_necesaria %}
            <p><strong>Fecha Necesaria:</strong> {{ pedido.fecha_necesaria }}</p>
            {% endif %}
            <p><strong>Tipo Factura:</strong> {{ pedido.tipo_factura }}</p>
            {% if pedido.nro_solicitud %}
            <p><strong>N° Solicitud:</strong> {{ pedido.nro_solicitud }}</p>
            {% endif %}
        </div>
    </div>

    <div class="card shadow">
             <div class="card-header bg-primary text-white">
    Items del pedido
</div>
        <div class="card-body">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Producto</th>
                        <th>Proveedor</th>
                        <th>Stock Actual</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% set total = 0 %}
                    {% for item in pedido.detalle %}
                    {% set subtotal = (item.cant_pedido|float * item.costo_unitario|float) %}
                    {% set total = total + subtotal %}
                    <tr>
                        <td>{{ item.item_code }}</td>
                        <td>{{ item.item_descripcion }}</td>
                        <td>{{ item.proveedor }}</td>
                        <td>{{ item.stock_actual|default(0) }}</td>
                        <td>{{ item.cant_pedido|default(0) }}</td>
                        <td>{{ "%.2f"|format(item.costo_unitario|default(0)) }}</td>
                        <td>{{ "%.2f"|format(subtotal) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="6" class="text-end">TOTAL</th>
                        <th>{{ "%.2f"|format(total) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="mt-3">
        <a href="{{ url_for('pdcmod.pedidos_index') }}" class="btn btn-secondary">Volver</a>
    </div>
</div>
{% endblock %}
